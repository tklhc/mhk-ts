<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mƒ∞HENK √úretim Y√∂netim Sistemi (Full)</title>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CSS (React'teki stillerin aynƒ±sƒ±) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    :root {
        --bg-dark: #0f1219;
        --bg-panel: #151b2b;
        --card-bg: rgba(255, 255, 255, 0.03);
        --border-color: rgba(255, 255, 255, 0.08);
        --primary: #3b82f6; --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
        --text-main: #e2e8f0; --text-muted: #94a3b8;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }

    /* Login Overlay */
    #login-overlay { position: fixed; inset: 0; background: #0f1219; z-index: 9999; display: flex; align-items: center; justify-content: center; }
    .login-box { width: 400px; padding: 30px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-color); border-radius: 16px; text-align: center; }

    /* Layout */
    .app { display: flex; width: 100%; height: 100%; display: none; /* Login olunca a√ßƒ±lƒ±r */ }
    .sidebar { width: 240px; background: var(--bg-panel); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 15px; overflow-y: auto; }
    .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .header { height: 60px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 24px; }
    .content { flex: 1; overflow-y: auto; padding: 24px; }

    /* Components */
    .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 14px; color: var(--text-muted); cursor: pointer; border-radius: 8px; margin-bottom: 2px; transition: 0.2s; border: none; background: none; width: 100%; text-align: left; font-size: 14px; }
    .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
    .nav-item.active { background: rgba(59,130,246,0.15); color: #60a5fa; font-weight: 600; }

    .card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 16px; }
    .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
    
    .badge { padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; }
    .badge-blue { background: rgba(59,130,246,0.15); color: #3b82f6; }
    .badge-green { background: rgba(16,185,129,0.15); color: #10b981; }
    .badge-red { background: rgba(239,68,68,0.15); color: #ef4444; }
    .badge-orange { background: rgba(245,158,11,0.15); color: #f59e0b; }
    .badge-gray { background: rgba(148,163,184,0.15); color: #94a3b8; }

    .btn { padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 13px; display: inline-flex; align-items: center; gap: 6px; transition: 0.2s; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-success { background: var(--success); color: white; }
    .btn-danger { background: rgba(239,68,68,0.2); color: #ef4444; }
    .btn-ghost { background: transparent; color: var(--text-muted); border: 1px solid var(--border-color); }
    .btn-sm { padding: 4px 10px; font-size: 11px; }

    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th { text-align: left; color: #64748b; padding: 10px; border-bottom: 1px solid var(--border-color); font-weight: 600; }
    td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.04); color: #e2e8f0; }

    /* Modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 1000; display: none; align-items: center; justify-content: center; }
    .modal-overlay.active { display: flex; }
    .modal-content { background: #1a1f2e; width: 800px; max-width: 95%; max-height: 90vh; overflow-y: auto; border-radius: 12px; border: 1px solid var(--border-color); padding: 24px; position: relative; }
    .close-modal { position: absolute; top: 16px; right: 16px; background: none; border: none; color: #94a3b8; cursor: pointer; font-size: 20px; }

    /* Inputs */
    .input-group { margin-bottom: 12px; }
    .input-label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 4px; }
    .input-field { width: 100%; padding: 8px 12px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white; font-family: inherit; }
</style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <div style="font-size: 40px; margin-bottom: 20px;">üè≠</div>
        <h2 style="color:white; margin-bottom:10px;">Mƒ∞HENK √úTS</h2>
        <p style="color:#94a3b8; margin-bottom:20px;">Kullanƒ±cƒ± Se√ßerek Giri≈ü Yapƒ±n</p>
        <div id="user-list" style="display:flex; flex-direction:column; gap:10px;"></div>
    </div>
</div>

<div class="app" id="app">
    <aside class="sidebar">
        <div style="display:flex; align-items:center; gap:10px; padding-bottom:20px; margin-bottom:10px; border-bottom:1px solid var(--border-color);">
            <div style="width:32px; height:32px; background:linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:white;">M</div>
            <span style="font-weight:700; color:white;">Mƒ∞HENK</span>
        </div>
        <nav id="nav-menu"></nav>
        <div style="margin-top:auto; padding-top:10px;">
            <button onclick="logout()" class="nav-item" style="color:#ef4444;"><i data-lucide="log-out"></i> √áƒ±kƒ±≈ü</button>
        </div>
    </aside>
    
    <main class="main">
        <header class="header">
            <h2 id="page-title" style="margin:0; font-size:18px;">Panel</h2>
            <div style="display:flex; align-items:center; gap:10px;">
                <span id="current-date" style="font-size:12px; color:#94a3b8;"></span>
                <div style="display:flex; align-items:center; gap:8px; background:rgba(255,255,255,0.05); padding:6px 12px; border-radius:20px;">
                    <div id="user-avatar" style="width:24px; height:24px; background:#3b82f6; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:bold;"></div>
                    <span id="user-name" style="font-size:13px; font-weight:600;"></span>
                </div>
            </div>
        </header>
        <div class="content" id="main-content">
            </div>
    </main>
</div>

<div class="modal-overlay" id="modal">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal()">√ó</button>
        <h3 id="modal-title" style="margin-bottom:20px; color:white;">Ba≈ülƒ±k</h3>
        <div id="modal-body"></div>
    </div>
</div>

<script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA & STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // React kodundaki verilerin aynƒ±sƒ±
    const USERS = [
        { id: "U1", name: "Taha", role: "admin", avatar: "T" },
        { id: "U2", name: "Ahmet Yƒ±lmaz", role: "operator", avatar: "A" },
        { id: "U3", name: "Fatma Demir", role: "manager", avatar: "F" },
        { id: "U4", name: "Zeynep Acar", role: "planner", avatar: "Z" }
    ];

    const MACHINES = [
        { id: "M1", name: "CNC-1 (Walter)", type: "CNC" }, { id: "M2", name: "CNC-2 (ANCA)", type: "CNC" },
        { id: "M3", name: "Ta≈ülama-1", type: "Ta≈ülama" }, { id: "M4", name: "Lazer Markalama", type: "Lazer" }
    ];

    // Global State
    let STATE = {
        user: null,
        page: "dashboard",
        orders: [
            { id:"SIP-2026-001", customer:"ABC Makina", date:"2026-02-10", delivery:"2026-02-28", status:"active", priority:"high", items:[{id:"I1", code:"E-4x50", qty:500, price:3.2}] },
            { id:"SIP-2026-002", customer:"XYZ Otomotiv", date:"2026-02-12", delivery:"2026-03-10", status:"active", priority:"normal", items:[{id:"I2", code:"EU-6x75", qty:200, price:5.5}] }
        ],
        workOrders: [],
        productionJobs: [],
        stock: [
            {code:"K10", desc:"Karb√ºr √áubuk √ò6mm", stock:410, unit:"ad"},
            {code:"K20", desc:"Karb√ºr √áubuk √ò8mm", stock:60, unit:"ad"}
        ],
        coatingQueue: [],
        operators: USERS.filter(u=>u.role==='operator')
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INITIALIZATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function init() {
        renderLogin();
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('tr-TR');
    }

    function renderLogin() {
        const list = document.getElementById('user-list');
        list.innerHTML = USERS.map(u => `
            <button onclick="login('${u.id}')" style="display:flex; align-items:center; gap:10px; padding:10px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:8px; cursor:pointer; width:100%;">
                <div style="width:30px; height:30px; background:#3b82f6; border-radius:6px; display:flex; align-items:center; justify-content:center; font-weight:bold;">${u.avatar}</div>
                <div style="text-align:left;"><div style="font-weight:600;">${u.name}</div><div style="font-size:11px; opacity:0.6;">${u.role}</div></div>
            </button>
        `).join('');
    }

    function login(id) {
        STATE.user = USERS.find(u => u.id === id);
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        document.getElementById('user-name').innerText = STATE.user.name;
        document.getElementById('user-avatar').innerText = STATE.user.avatar;
        renderNav();
        navigate('dashboard');
    }

    function logout() { location.reload(); }

    function navigate(pageId) {
        STATE.page = pageId;
        renderNav();
        const content = document.getElementById('main-content');
        const title = document.getElementById('page-title');
        
        // Router Logic
        const pages = {
            'dashboard': { title: 'Panel', render: renderDashboard },
            'orders': { title: 'Sipari≈üler', render: renderOrders },
            'workorders': { title: 'ƒ∞≈ü Emirleri', render: renderWorkOrders },
            'planning': { title: 'Planlama', render: renderPlanning },
            'production': { title: '√úretim Takip', render: renderProduction },
            'qc': { title: 'Kalite Kontrol', render: renderQC },
            'coating': { title: 'Kaplama', render: renderCoating },
            'shipping': { title: 'Sevkiyat', render: renderShipping },
            'stock': { title: 'Stok', render: renderStock },
            'machines': { title: 'Makinalar', render: renderMachines },
            'operators': { title: 'Operat√∂rler', render: renderOperators },
            'users': { title: 'Kullanƒ±cƒ±lar', render: renderUsers }
        };

        const p = pages[pageId];
        if(p) {
            title.innerText = p.title;
            content.innerHTML = p.render();
            lucide.createIcons();
        }
    }

    function renderNav() {
        const items = [
            { id:'dashboard', icon:'layout-dashboard', label:'Panel' },
            { id:'orders', icon:'package', label:'Sipari≈üler' },
            { id:'workorders', icon:'clipboard-list', label:'ƒ∞≈ü Emirleri' },
            { id:'planning', icon:'calendar', label:'Planlama' },
            { id:'production', icon:'factory', label:'√úretim' },
            { id:'qc', icon:'check-circle-2', label:'Kalite Kontrol' },
            { id:'coating', icon:'layers', label:'Kaplama' },
            { id:'shipping', icon:'truck', label:'Sevkiyat' },
            { id:'stock', icon:'box', label:'Stok' },
            { id:'machines', icon:'monitor', label:'Makinalar' },
            { id:'operators', icon:'users', label:'Operat√∂rler' },
            { id:'users', icon:'user-cog', label:'Kullanƒ±cƒ±lar' } // Admin only logic can be added
        ];
        
        document.getElementById('nav-menu').innerHTML = items.map(i => `
            <button onclick="navigate('${i.id}')" class="nav-item ${STATE.page === i.id ? 'active' : ''}">
                <i data-lucide="${i.icon}" width="18"></i> ${i.label}
            </button>
        `).join('');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE RENDERERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function renderDashboard() {
        const total = STATE.orders.length;
        const activeWO = STATE.workOrders.filter(w=>w.status!=='completed').length;
        return `
            <div class="grid-4" style="margin-bottom:20px;">
                <div class="card" style="display:flex; align-items:center; gap:15px;">
                    <div style="padding:12px; background:rgba(59,130,246,0.2); color:#3b82f6; border-radius:10px;"><i data-lucide="package"></i></div>
                    <div><div style="font-size:24px; font-weight:700; color:white;">${total}</div><div style="font-size:12px; color:#94a3b8;">Toplam Sipari≈ü</div></div>
                </div>
                <div class="card" style="display:flex; align-items:center; gap:15px;">
                    <div style="padding:12px; background:rgba(16,185,129,0.2); color:#10b981; border-radius:10px;"><i data-lucide="activity"></i></div>
                    <div><div style="font-size:24px; font-weight:700; color:white;">${activeWO}</div><div style="font-size:12px; color:#94a3b8;">Aktif ƒ∞≈ü Emri</div></div>
                </div>
                <div class="card" style="display:flex; align-items:center; gap:15px;">
                    <div style="padding:12px; background:rgba(245,158,11,0.2); color:#f59e0b; border-radius:10px;"><i data-lucide="factory"></i></div>
                    <div><div style="font-size:24px; font-weight:700; color:white;">${STATE.productionJobs.length}</div><div style="font-size:12px; color:#94a3b8;">√úretimdeki ƒ∞≈ü</div></div>
                </div>
                <div class="card" style="display:flex; align-items:center; gap:15px;">
                    <div style="padding:12px; background:rgba(239,68,68,0.2); color:#ef4444; border-radius:10px;"><i data-lucide="alert-triangle"></i></div>
                    <div><div style="font-size:24px; font-weight:700; color:white;">${STATE.stock.filter(s=>s.stock<100).length}</div><div style="font-size:12px; color:#94a3b8;">Kritik Stok</div></div>
                </div>
            </div>
            <div class="card">
                <h3 style="color:white; margin-bottom:15px;">Son Hareketler</h3>
                <div style="color:#94a3b8; font-size:13px;">Sistemde ger√ßekle≈üen son i≈ülemler burada listelenir...</div>
            </div>
        `;
    }

    function renderOrders() {
        return `
            <div style="display:flex; justify-content:flex-end; margin-bottom:15px;"><button onclick="openOrderModal()" class="btn btn-primary"><i data-lucide="plus"></i> Yeni Sipari≈ü</button></div>
            <div class="card">
                <table>
                    <thead><tr><th>No</th><th>M√º≈üteri</th><th>Tarih</th><th>Termin</th><th>Durum</th><th>ƒ∞≈ülem</th></tr></thead>
                    <tbody>
                        ${STATE.orders.map(o => `
                            <tr>
                                <td style="font-weight:600; color:white;">${o.id}</td>
                                <td>${o.customer}</td>
                                <td>${o.date}</td>
                                <td>${o.delivery}</td>
                                <td><span class="badge badge-green">${o.status}</span></td>
                                <td>
                                    <button class="btn btn-ghost btn-sm" onclick="createWorkOrder('${o.id}')">ƒ∞≈ü Emri Olu≈ütur</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    function renderWorkOrders() {
        if(STATE.workOrders.length === 0) return `<div class="card" style="text-align:center; padding:40px; color:#94a3b8;">Hen√ºz i≈ü emri yok. Sipari≈ülerden olu≈üturun.</div>`;
        return STATE.workOrders.map(wo => `
            <div class="card">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <div><span class="badge badge-blue">${wo.id}</span> <span style="font-weight:600; color:white; margin-left:10px;">${wo.customer}</span></div>
                    <span class="badge badge-gray">Adƒ±m: ${wo.step}</span>
                </div>
                <div style="font-size:13px; color:#94a3b8; margin-bottom:10px;">
                    ${wo.items.map(i=> `<div>‚Ä¢ ${i.code} - ${i.qty} adet</div>`).join('')}
                </div>
                <div style="display:flex; gap:10px;">
                    ${wo.step === 'planning' ? `<button onclick="moveToProduction('${wo.id}')" class="btn btn-primary btn-sm">Planlamayƒ± Tamamla</button>` : ''}
                    ${wo.step === 'production' ? `<span style="color:#3b82f6; font-size:12px;">√úretim ekranƒ±nda takip ediliyor</span>` : ''}
                </div>
            </div>
        `).join('');
    }

    function renderPlanning() {
        return `
            <div class="card">
                <h3 style="color:white; margin-bottom:15px;">Makine Y√ºkleme √áizelgesi</h3>
                ${MACHINES.map(m => `
                    <div style="margin-bottom:15px;">
                        <div style="font-size:13px; color:#94a3b8; margin-bottom:5px;">${m.name}</div>
                        <div style="height:40px; background:rgba(255,255,255,0.05); border-radius:6px; position:relative; overflow:hidden;">
                            ${STATE.productionJobs.filter(j=>j.machineId===m.id).map((j, idx)=>`
                                <div style="position:absolute; left:${idx*100}px; width:90px; height:100%; background:rgba(59,130,246,0.2); border-left:2px solid #3b82f6; padding:5px; font-size:10px; color:white;">
                                    ${j.code}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    }

    function renderProduction() {
        const active = STATE.productionJobs.filter(j => j.status !== 'completed');
        return `
            <div class="card">
                <h3 style="color:white; margin-bottom:15px;">Aktif √úretim (${active.length})</h3>
                ${active.length === 0 ? '<div style="color:#94a3b8;">Aktif i≈ü yok</div>' : ''}
                ${active.map(j => `
                    <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:8px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:600; color:white;">${j.code}</div>
                            <div style="font-size:12px; color:#94a3b8;">${j.customer} | ${j.qty} ad</div>
                            <div style="font-size:12px; color:#3b82f6;">${MACHINES.find(m=>m.id===j.machineId)?.name}</div>
                        </div>
                        <div>
                            ${j.status === 'pending' ? `<button onclick="startJob('${j.id}')" class="btn btn-success btn-sm"><i data-lucide="play"></i> Ba≈ülat</button>` : 
                              `<button onclick="finishJob('${j.id}')" class="btn btn-danger btn-sm"><i data-lucide="square"></i> Bitir</button>`}
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    }

    function renderQC() {
        const qcItems = STATE.workOrders.filter(w => w.step === 'qc');
        return `
            <div class="card">
                <h3 style="color:white; margin-bottom:15px;">Kalite Kontrol Bekleyenler</h3>
                ${qcItems.length === 0 ? '<div style="color:#94a3b8;">Liste bo≈ü</div>' : qcItems.map(w => `
                    <div style="padding:15px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between;">
                        <div><div style="color:white; font-weight:600;">${w.customer}</div><div style="font-size:12px; color:#94a3b8;">${w.id}</div></div>
                        <button onclick="approveQC('${w.id}')" class="btn btn-success btn-sm">Onayla</button>
                    </div>
                `).join('')}
            </div>
        `;
    }

    function renderCoating() { return genericList('Kaplama', 'coating', 'approveCoating', 'Sevkiyata G√∂nder'); }
    function renderShipping() { return genericList('Sevkiyat', 'shipping', 'completeShipping', 'Sevk Et & Bitir'); }
    
    function genericList(title, step, actionFn, btnText) {
        const items = STATE.workOrders.filter(w => w.step === step);
        return `
            <div class="card">
                <h3 style="color:white; margin-bottom:15px;">${title} Listesi</h3>
                ${items.length===0?'<div style="color:#94a3b8;">Bo≈ü</div>':''}
                ${items.map(w => `
                    <div style="padding:10px; border:1px solid rgba(255,255,255,0.1); border-radius:8px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                        <span style="color:white;">${w.id} - ${w.customer}</span>
                        <button onclick="${actionFn}('${w.id}')" class="btn btn-primary btn-sm">${btnText}</button>
                    </div>
                `).join('')}
            </div>
        `;
    }

    function renderStock() {
        return `
            <div class="card">
                <table>
                    <thead><tr><th>Kod</th><th>A√ßƒ±klama</th><th>Miktar</th><th>Durum</th></tr></thead>
                    <tbody>
                        ${STATE.stock.map(s => `
                            <tr>
                                <td style="color:white;">${s.code}</td>
                                <td>${s.desc}</td>
                                <td style="font-weight:bold; color:${s.stock<100?'#ef4444':'white'}">${s.stock} ${s.unit}</td>
                                <td><span class="badge ${s.stock<100?'badge-red':'badge-green'}">${s.stock<100?'Kritik':'Yeterli'}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    function renderMachines() {
        return `<div class="grid-4">${MACHINES.map(m=>`<div class="card" style="text-align:center;"><div style="font-size:40px; margin-bottom:10px;">ü§ñ</div><div style="color:white; font-weight:600;">${m.name}</div><div style="color:#94a3b8; font-size:12px;">${m.type}</div></div>`).join('')}</div>`;
    }
    function renderOperators() {
        return `<div class="grid-4">${STATE.operators.map(o=>`<div class="card" style="display:flex; gap:10px; align-items:center;"><div style="width:40px; height:40px; background:#3b82f6; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">${o.avatar}</div><div><div style="color:white; font-weight:600;">${o.name}</div><div style="color:#94a3b8; font-size:12px;">Operat√∂r</div></div></div>`).join('')}</div>`;
    }
    function renderUsers() { return `<div class="card">Kullanƒ±cƒ± y√∂netimi paneli (Admin yetkisi gerekir).</div>`; }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIC & ACTIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function openOrderModal() {
        document.getElementById('modal-title').innerText = "Yeni Sipari≈ü";
        document.getElementById('modal-body').innerHTML = `
            <div class="input-group"><label class="input-label">M√º≈üteri</label><input id="new-cust" class="input-field" placeholder="Firma Adƒ±"></div>
            <div class="input-group"><label class="input-label">Termin</label><input id="new-date" type="date" class="input-field"></div>
            <button onclick="saveOrder()" class="btn btn-primary" style="width:100%;">Kaydet</button>
        `;
        document.getElementById('modal').classList.add('active');
    }

    function saveOrder() {
        const cust = document.getElementById('new-cust').value;
        const date = document.getElementById('new-date').value;
        if(!cust || !date) return alert("Alanlarƒ± doldurun!");
        STATE.orders.push({ id:`SIP-2026-00${STATE.orders.length+1}`, customer:cust, date:new Date().toISOString().slice(0,10), delivery:date, status:'active', items:[] });
        closeModal();
        navigate('orders');
    }

    function createWorkOrder(orderId) {
        const order = STATE.orders.find(o=>o.id===orderId);
        // Duplicate check simple
        if(STATE.workOrders.find(w=>w.refId === orderId)) return alert("Bu sipari≈ü i√ßin zaten i≈ü emri var.");
        
        STATE.workOrders.push({
            id: `IE-${Math.floor(Math.random()*1000)}`,
            refId: orderId,
            customer: order.customer,
            step: 'planning',
            status: 'active',
            items: order.items
        });
        alert("ƒ∞≈ü emri olu≈üturuldu! ƒ∞≈ü Emirleri sayfasƒ±na gidin.");
    }

    function moveToProduction(woId) {
        const wo = STATE.workOrders.find(w=>w.id===woId);
        wo.step = 'production';
        // Create dummy jobs
        wo.items.forEach((item, idx) => {
            STATE.productionJobs.push({
                id: `JOB-${wo.id}-${idx}`,
                woId: wo.id,
                code: item.code,
                customer: wo.customer,
                qty: item.qty,
                machineId: MACHINES[idx % MACHINES.length].id, // Auto assign round robin
                status: 'pending'
            });
        });
        navigate('workorders');
    }

    function startJob(jobId) {
        STATE.productionJobs.find(j=>j.id===jobId).status = 'running';
        navigate('production');
    }

    function finishJob(jobId) {
        const job = STATE.productionJobs.find(j=>j.id===jobId);
        job.status = 'completed';
        
        // Check if all jobs for WO are done
        const allJobsDone = STATE.productionJobs.filter(j=>j.woId === job.woId).every(j=>j.status==='completed');
        if(allJobsDone) {
            const wo = STATE.workOrders.find(w=>w.id === job.woId);
            if(wo) wo.step = 'qc';
        }
        navigate('production');
    }

    function approveQC(woId) { STATE.workOrders.find(w=>w.id===woId).step = 'coating'; navigate('qc'); }
    function approveCoating(woId) { STATE.workOrders.find(w=>w.id===woId).step = 'shipping'; navigate('coating'); }
    function completeShipping(woId) { 
        const wo = STATE.workOrders.find(w=>w.id===woId);
        wo.step = 'completed'; 
        wo.status = 'completed';
        navigate('shipping'); 
    }

    function closeModal() { document.getElementById('modal').classList.remove('active'); }

    // Start App
    init();
</script>
</body>
</html>
