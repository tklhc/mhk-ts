<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miheng Üretim Yönetim Sistemi</title>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
    /* ════════ TEMEL CSS VE RESET ════════ */
    :root {
        --bg-dark: #0f1219;
        --bg-panel: #151b2b;
        --card-bg: rgba(255, 255, 255, 0.03);
        --border-color: rgba(255, 255, 255, 0.08);
        --primary: #3b82f6;
        --text-main: #e2e8f0;
        --text-muted: #94a3b8;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
        font-family: 'Segoe UI', system-ui, sans-serif;
        background-color: var(--bg-dark);
        color: var(--text-main);
        height: 100vh;
        overflow: hidden;
        display: flex;
    }

    /* ════════ LOGIN EKRANI ════════ */
    #login-screen {
        position: fixed;
        inset: 0;
        background: var(--bg-dark);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .login-card {
        width: 400px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 32px;
        text-align: center;
    }
    .user-select-btn {
        width: 100%;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(255,255,255,0.05);
        border: 1px solid var(--border-color);
        color: white;
        margin-bottom: 8px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
    }
    .user-select-btn:hover { background: rgba(255,255,255,0.1); }

    /* ════════ SIDEBAR ════════ */
    .sidebar {
        width: 240px;
        background: var(--bg-panel);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        padding: 16px;
        transition: 0.3s;
    }
    .logo-area {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 24px;
        padding-left: 8px;
    }
    .logo-box {
        width: 32px; height: 32px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        border-radius: 8px;
        display: flex; align-items: center; justify-content: center;
        font-weight: bold;
    }
    .nav-btn {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        color: var(--text-muted);
        background: transparent;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        text-align: left;
        font-size: 14px;
        margin-bottom: 4px;
    }
    .nav-btn:hover { color: white; background: rgba(255,255,255,0.05); }
    .nav-btn.active { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
    
    /* ════════ ANA İÇERİK ════════ */
    .main-content {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
    }
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }
    .header-user {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(255,255,255,0.05);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
    }

    /* ════════ KARTLAR VE TABLOLAR ════════ */
    .card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    .stat-card {
        padding: 16px;
        border-radius: 12px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 16px;
    }
    
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th { text-align: left; color: var(--text-muted); padding: 12px; border-bottom: 1px solid var(--border-color); }
    td { padding: 12px; color: var(--text-main); border-bottom: 1px solid rgba(255,255,255,0.04); }
    
    /* ════════ BİLEŞENLER (Badge, Button) ════════ */
    .badge {
        display: inline-flex;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
    }
    .badge-blue { background: rgba(59,130,246,0.15); color: #3b82f6; }
    .badge-green { background: rgba(16,185,129,0.15); color: #10b981; }
    .badge-red { background: rgba(239,68,68,0.15); color: #ef4444; }
    .badge-yellow { background: rgba(245,158,11,0.15); color: #f59e0b; }

    .btn {
        padding: 8px 16px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-danger { background: rgba(239,68,68,0.2); color: #ef4444; }
    .btn-ghost { background: transparent; color: var(--text-muted); border: 1px solid var(--border-color); }
    .btn-sm { padding: 4px 10px; font-size: 11px; }

    /* ════════ MODAL ════════ */
    .modal-overlay {
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center; justify-content: center;
        z-index: 2000;
    }
    .modal-overlay.active { display: flex; }
    .modal-box {
        background: #1a1f2e;
        width: 600px;
        max-width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        padding: 24px;
        position: relative;
    }
    .close-modal { position: absolute; top: 16px; right: 16px; background: none; border: none; color: white; cursor: pointer; font-size: 18px; }

    /* ════════ UTILS ════════ */
    .hidden { display: none !important; }
</style>
</head>
<body>

<div id="login-screen">
    <div class="login-card">
        <div class="logo-box" style="margin: 0 auto 20px auto; width: 48px; height: 48px; font-size: 20px;">M</div>
        <h2 style="color:white; margin-bottom: 10px;">MİHENK Üretim Takip</h2>
        <p style="color:#94a3b8; margin-bottom: 24px; font-size: 13px;">Giriş yapmak için kullanıcı seçin</p>
        <div id="user-list"></div>
    </div>
</div>

<div id="app-container" style="display: none; width: 100%; height: 100%;">
    
    <aside class="sidebar">
        <div class="logo-area">
            <div class="logo-box">M</div>
            <span style="font-weight: bold; color: white;">MIHENG ÜTS</span>
        </div>
        <nav id="nav-menu">
            </nav>
        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color);">
            <button onclick="logout()" class="nav-btn" style="color: #ef4444;">
                <i data-lucide="log-out"></i> Çıkış Yap
            </button>
        </div>
    </aside>

    <main class="main-content">
        <header class="page-header">
            <h2 id="page-title" style="margin:0;">Panel</h2>
            <div class="header-user">
                <i data-lucide="user"></i>
                <span id="current-user-name">Kullanıcı</span>
            </div>
        </header>

        <div id="content-area"></div>
    </main>
</div>

<div id="main-modal" class="modal-overlay">
    <div class="modal-box">
        <button class="close-modal" onclick="closeModal()">✕</button>
        <h3 id="modal-title" style="margin-bottom: 20px; color: white;">Modal Başlık</h3>
        <div id="modal-body"></div>
    </div>
</div>

<script>
    // ════════════════════════ VERİ VE STATE ════════════════════════
    const USERS = [
        { id: "U1", name: "Taha", role: "admin", avatar: "T" },
        { id: "U2", name: "Ahmet Yılmaz", role: "operator", avatar: "A" },
        { id: "U4", name: "Fatma Demir", role: "manager", avatar: "F" },
        { id: "U5", name: "Zeynep Acar", role: "planner", avatar: "Z" }
    ];

    const MACHINES = [
        { id: "M1", name: "CNC-1 (Walter)", type: "CNC", status: "active" },
        { id: "M2", name: "CNC-2 (ANCA)", type: "CNC", status: "active" },
        { id: "M3", name: "CNC-3 (Rollomatic)", type: "CNC", status: "active" },
        { id: "M4", name: "Taşlama-1", type: "Taşlama", status: "active" }
    ];

    let SAMPLE_ORDERS = [
        {
            id: "SIP-2026-001", customerName: "ABC Makina Ltd.", date: "2026-02-10", deliveryDate: "2026-02-28", status: "active", priority: "high",
            items: [{ id: "I1", productCode: "E-4x50", qty: 500, unitPrice: 3.20 }]
        },
        {
            id: "SIP-2026-002", customerName: "XYZ Otomotiv", date: "2026-02-12", deliveryDate: "2026-03-10", status: "active", priority: "normal",
            items: [{ id: "I2", productCode: "EU-6x75", qty: 200, unitPrice: 5.50 }]
        }
    ];

    // Global Uygulama Durumu
    const STATE = {
        currentUser: null,
        activePage: 'dashboard',
        orders: [...SAMPLE_ORDERS],
        productionJobs: [],
        workOrders: []
    };

    // ════════════════════════ TEMEL FONKSİYONLAR ════════════════════════

    function init() {
        renderLoginScreen();
        lucide.createIcons();
    }

    function renderLoginScreen() {
        const list = document.getElementById('user-list');
        list.innerHTML = USERS.map(u => `
            <div class="user-select-btn" onclick="login('${u.id}')">
                <div style="width:30px;height:30px;background:#3b82f6;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;">${u.avatar}</div>
                <div style="text-align:left;">
                    <div style="font-weight:600;">${u.name}</div>
                    <div style="font-size:11px;opacity:0.7;">${u.role.toUpperCase()}</div>
                </div>
            </div>
        `).join('');
    }

    function login(userId) {
        STATE.currentUser = USERS.find(u => u.id === userId);
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app-container').style.display = 'flex';
        document.getElementById('current-user-name').innerText = STATE.currentUser.name;
        renderSidebar();
        navigate('dashboard');
    }

    function logout() {
        location.reload();
    }

    function navigate(page) {
        STATE.activePage = page;
        renderSidebar(); // Buton aktifliğini güncelle
        
        const content = document.getElementById('content-area');
        const title = document.getElementById('page-title');

        if(page === 'dashboard') {
            title.innerText = "Panel";
            content.innerHTML = renderDashboard();
        } else if(page === 'orders') {
            title.innerText = "Siparişler";
            content.innerHTML = renderOrdersPage();
        } else if(page === 'production') {
            title.innerText = "Üretim Takip";
            content.innerHTML = renderProductionPage();
        } else if(page === 'machines') {
            title.innerText = "Makinalar";
            content.innerHTML = renderMachinesPage();
        }

        lucide.createIcons();
    }

    // ════════════════════════ GÖRÜNÜM (RENDER) ════════════════════════

    function renderSidebar() {
        const menu = [
            { id: 'dashboard', label: 'Panel', icon: 'home' },
            { id: 'orders', label: 'Siparişler', icon: 'package' },
            { id: 'production', label: 'Üretim', icon: 'factory' },
            { id: 'machines', label: 'Makinalar', icon: 'monitor' }
        ];

        document.getElementById('nav-menu').innerHTML = menu.map(item => `
            <button onclick="navigate('${item.id}')" class="nav-btn ${STATE.activePage === item.id ? 'active' : ''}">
                <i data-lucide="${item.icon}"></i> ${item.label}
            </button>
        `).join('');
        lucide.createIcons();
    }

    // --- DASHBOARD ---
    function renderDashboard() {
        const totalOrders = STATE.orders.length;
        const activeOrders = STATE.orders.filter(o => o.status === 'active').length;
        
        return `
            <div class="stats-grid">
                <div class="stat-card">
                    <div style="padding:10px; background:rgba(59,130,246,0.2); border-radius:8px; color:#3b82f6;"><i data-lucide="package"></i></div>
                    <div>
                        <div style="font-size:24px; font-weight:bold; color:white;">${totalOrders}</div>
                        <div style="font-size:12px; color:#94a3b8;">Toplam Sipariş</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div style="padding:10px; background:rgba(16,185,129,0.2); border-radius:8px; color:#10b981;"><i data-lucide="activity"></i></div>
                    <div>
                        <div style="font-size:24px; font-weight:bold; color:white;">${activeOrders}</div>
                        <div style="font-size:12px; color:#94a3b8;">Aktif Sipariş</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div style="padding:10px; background:rgba(245,158,11,0.2); border-radius:8px; color:#f59e0b;"><i data-lucide="monitor"></i></div>
                    <div>
                        <div style="font-size:24px; font-weight:bold; color:white;">${MACHINES.length}</div>
                        <div style="font-size:12px; color:#94a3b8;">Makine Sayısı</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom:15px; color:white;">Son Siparişler</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Sipariş No</th>
                            <th>Müşteri</th>
                            <th>Tarih</th>
                            <th>Öncelik</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${STATE.orders.map(o => `
                            <tr>
                                <td style="font-weight:600; color:white;">${o.id}</td>
                                <td>${o.customerName}</td>
                                <td>${o.date}</td>
                                <td><span class="badge ${o.priority==='high'?'badge-red':'badge-blue'}">${o.priority==='high'?'Yüksek':'Normal'}</span></td>
                                <td><span class="badge badge-green">Aktif</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    // --- SİPARİŞLER SAYFASI ---
    function renderOrdersPage() {
        return `
            <div style="margin-bottom:20px; display:flex; justify-content:flex-end;">
                <button class="btn btn-primary" onclick="openNewOrderModal()">
                    <i data-lucide="plus"></i> Yeni Sipariş
                </button>
            </div>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Müşteri</th>
                            <th>Termin</th>
                            <th>Kalem Adedi</th>
                            <th>Tutar</th>
                            <th>İşlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${STATE.orders.map(o => {
                            const total = o.items.reduce((acc, i) => acc + (i.qty * i.unitPrice), 0);
                            return `
                            <tr>
                                <td>${o.id}</td>
                                <td style="color:white; font-weight:500;">${o.customerName}</td>
                                <td>${o.deliveryDate}</td>
                                <td>${o.items.length}</td>
                                <td style="color:#10b981; font-weight:bold;">€${total.toFixed(2)}</td>
                                <td>
                                    <button class="btn btn-ghost btn-sm" onclick="alert('Detaylar: ${o.id}')">Detay</button>
                                </td>
                            </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    // --- ÜRETİM SAYFASI ---
    function renderProductionPage() {
        return `
            <div class="card">
                <div style="text-align:center; padding:40px; color:#94a3b8;">
                    <i data-lucide="factory" size="48" style="margin-bottom:10px; width:48px; height:48px;"></i>
                    <p>Şu anda aktif üretim işi bulunmamaktadır.</p>
                    <p style="font-size:12px;">Siparişlerden iş emri oluşturarak burayı doldurabilirsiniz.</p>
                </div>
            </div>
        `;
    }

    // --- MAKİNALAR SAYFASI ---
    function renderMachinesPage() {
        return `
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:16px;">
                ${MACHINES.map(m => `
                    <div class="card" style="margin-bottom:0;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <h4 style="color:white;">${m.name}</h4>
                            <span class="badge badge-green">Aktif</span>
                        </div>
                        <div style="font-size:13px; color:#94a3b8;">Tip: ${m.type}</div>
                        <div style="margin-top:15px; height:4px; background:rgba(255,255,255,0.1); border-radius:2px;">
                            <div style="width:0%; height:100%; background:#3b82f6;"></div>
                        </div>
                        <div style="font-size:11px; margin-top:5px; text-align:right; color:#64748b;">Yük: %0</div>
                    </div>
                `).join('')}
            </div>
        `;
    }

    // ════════════════════════ MODAL İŞLEMLERİ ════════════════════════

    function closeModal() {
        document.getElementById('main-modal').classList.remove('active');
    }

    function openNewOrderModal() {
        const modal = document.getElementById('main-modal');
        const title = document.getElementById('modal-title');
        const body = document.getElementById('modal-body');

        title.innerText = "Yeni Sipariş Oluştur";
        body.innerHTML = `
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:16px;">
                <div>
                    <label style="font-size:12px; color:#94a3b8;">Müşteri Adı</label>
                    <input type="text" id="new-cust" style="width:100%; padding:8px; background:#0f1219; border:1px solid rgba(255,255,255,0.1); color:white; border-radius:6px;">
                </div>
                <div>
                    <label style="font-size:12px; color:#94a3b8;">Termin Tarihi</label>
                    <input type="date" id="new-date" style="width:100%; padding:8px; background:#0f1219; border:1px solid rgba(255,255,255,0.1); color:white; border-radius:6px;">
                </div>
            </div>
            <div style="text-align:right;">
                <button class="btn btn-ghost" onclick="closeModal()">İptal</button>
                <button class="btn btn-primary" onclick="saveOrder()">Kaydet</button>
            </div>
        `;
        modal.classList.add('active');
    }

    function saveOrder() {
        const customer = document.getElementById('new-cust').value;
        const date = document.getElementById('new-date').value;

        if(!customer || !date) { alert("Lütfen alanları doldurun"); return; }

        const newOrder = {
            id: `SIP-2026-00${STATE.orders.length + 1}`,
            customerName: customer,
            date: new Date().toISOString().split('T')[0],
            deliveryDate: date,
            status: "active",
            priority: "normal",
            items: [{ qty: 100, unitPrice: 0 }] // Dummy item
        };

        STATE.orders.push(newOrder);
        closeModal();
        navigate('orders'); // Listeyi yenile
    }

    // Uygulamayı Başlat
    init();

</script>
</body>
</html>
